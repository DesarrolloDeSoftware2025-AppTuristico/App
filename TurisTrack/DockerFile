# ETAPA 1: Construcción (Build)
# Usamos la imagen SDK que tiene todas las herramientas para compilar
FROM mcr.microsoft.com/dotnet/sdk:9.0 AS build
WORKDIR /src

# Copiamos TODO el código fuente de la solución al contenedor
# (Es necesario copiar todo porque HttpApi.Host depende de Domain, Application, etc.)
COPY . .

# Restauramos dependencias y compilamos el proyecto específico
# IMPORTANTE: Verifica que la ruta a tu .csproj sea correcta.
# En ABP suele ser src/Nombre.HttpApi.Host/Nombre.HttpApi.Host.csproj
RUN dotnet publish "src/TurisTrack.HttpApi.Host/TurisTrack.HttpApi.Host.csproj" -c Release -o /app/publish

# ETAPA 2: Ejecución (Runtime)
# Usamos una imagen más ligera solo para correr la app
FROM mcr.microsoft.com/dotnet/aspnet:9.0
WORKDIR /app
COPY --from=build /app/publish .

# Configuración para Render (Render asigna puertos dinámicos, pero expone el 8080 por defecto en .NET 8/9)
ENV ASPNETCORE_HTTP_PORTS=8080
EXPOSE 8080

ENTRYPOINT ["dotnet", "TurisTrack.HttpApi.Host.dll"]
